@{
    ViewBag.Title = "UsersList";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}

@model PagedList<Bus.Data.UsersView>
<script type="text/javascript" src="/Content/layer/layer.min.js?v=1.6.0"></script>
 <script type="text/javascript">
     function OpenMap(v) {
         var h = $(document).height();
         h = h - 80;
         $.layer({
             type: 2,
             title: '根据地图位置搜索用户。',
             iframe: { src: 'soMap' },
             area: ['920px', h+'px'],
             offset: ['30px', '']
         });
     }
 </script>
<style type="text/css">
	html{_overflow-y:scroll}

    .auto-hide{ 
        table-layout: fixed;
    }
    .auto-hide td{
        cursor:pointer;
        overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    }
</style>

<table width="100%" cellspacing="0" class="search-form" >
    <tbody>
        <tr>
            <td>
                <div class="explain-col" style="line-height:33px;">
                    @{var StartLatLong = TheCMS.Common.iRequest.GetQueryString("StartLatLong");
                      var EndLatLong = TheCMS.Common.iRequest.GetQueryString("EndLatLong");}

                    居住地：<input name="StartLatLong" id="StartLatLong" type="text" value="@(StartLatLong)" class="input-text"><a href="javascript:;;" onclick="OpenMap(1)"><font color="red">选择</font></a>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    工作地：<input name="EndLatLong" type="text" value="@(EndLatLong)" class="input-text"><a href="javascript:;;" onclick="OpenMap(2)"><font color="red">选择</font></a>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    @{var stateid = TheCMS.Common.iRequest.GetQueryInt("StateID", -1);}
                    <select id="StateID" name="StateID">
                        <option value="-1" @(stateid==-1?" selected":"")>所有状态</option>
                        @{var allslist = Bus.Data.UserStateDB.UserStateList();}
                        @foreach(var item in allslist)
                        {
                        <option value="@(item.ID)" @(stateid==item.ID?" selected":"")>@(item.StateName)</option>
                        } 
                    </select>

                    <div class="content-menu ib-a blue line-x" style="float:right; margin-top:-30px;text-align:right;">
                        <a href='javascript:SearchArea();' class="on"><em>位置搜索</em></a>&nbsp;
                    </div>
                    </div>
            </td>
        </tr>
    </tbody>
</table>

<script type="text/javascript">

    function GoSearch() {

        var P = $("#Phone").val();
        var N = $("#Names").val();
        var A1 = $("#A1").val();
        var A2 = $("#A2").val();
        var t1 = $("#T1").val();
        var t2 = $("#T2").val();
        var StateID = $("#StateID").val();
        var LN = $("#LN").val();
        //乘车类型
        var RT = "";
        $('input[name="RT"]:checked').each(function(){//遍历每一个名字为RT的复选框，其中选中的执行函数    
            RT += $(this).val() + "_";
        });

        //未分车
        var NoLine = "";
        if ($("#NoLine").prop("checked")) {
            NoLine = $("#NoLine").val();
        }

        var corp = $("#corp").val();
        var u = "UsersList?Names=" + N + "&Phone=" + P + "&StateID=" + StateID + "&A1=" + A1 + "&A2=" + A2 + "&t1=" + t1 + "&t2=" + t2
                + "&corp=" + corp + "&LN=" + LN + "&RT=" + RT + "&NoLine=" + NoLine;
        //alert(u);
        window.location.href = u;
    }

    function SearchArea() {
        window.location.href = "UsersList2";
    }

    $(document).ready(function() {
        $("#AllUser").click(function() {
            if ($(this).attr("checked") == "checked") {
                $("input[name='_id']").attr("checked", true);
                $("#chosetable").show();
            } else {
                $("input[name='_id']").attr("checked", false);
                $("#chosetable").hide();
            }
        });
       
    });
    function ChangeChose() {
        var arrChk = $("input[name='_id']:checked");
        if (arrChk.length > 0) {
            $("#chosetable").show();
        } else {
            $("#chosetable").hide();
        }
    }
    function successmsg4(url, txt) {
        if (txt == "") { txt = "successed."; }
        layer.msg(txt, 1, 1, function () {
            window.location.href = url;
        });
    }
</script>
<div class="pad_10">

<div class="bk10"></div>
<div class="table-list">
    <table id="userList" width="100%" cellspacing="0" border="0" class="auto-hide">
        <thead>
            <tr><th width="25px" align="left"><input type="checkbox" id="AllUser" /></th>
                <th width="100px" align="left">线路信息</th>
                <th width="60px" align="left" >姓名</th>
                <th width="30px" align="left">性别</th> 
                <th width="90px" align="left">电话</th>
                <th width="110" align="left">公司</th>
                <th width="130" align="left">居住地</th>
                <th width="130" align="left">工作地</th>
                <th width="50" align="left">上班时</th>
                <th width="50" align="left">下班时</th>

                @{var yymm = Bus.Core.Common.GetYearMonthList();}
                @foreach (var item in yymm)
                {
                    <th width="40" align="center">@(item.Substring(4))月</th>
                }
			    <th width="180" align="left">备注</th>
            </tr>
        </thead>
    <tbody>
        @if (Model.Count == 0) { 
        <tr>
            <td colspan="13">没有任何数据</td>
        </tr>
        }
        @foreach(var item in Model){
            <tr>
                <td>
                    <input type="checkbox" value="@(item.ID)" name="_id" onclick="ChangeChose()" />
                </td>
                <td align="left">@(item.LineName)</td>
	            <td align="left" style="cursor:pointer;text-decoration:underline;">
                    <a onclick="openUsers(@(item.ID), '@(item.Names)')">@(item.Names)</a>
	            </td>
                <td align="left">@(item.Sex==1?"男":item.Sex==2?"女":"")</td>
                <td  align="left">@(item.Phone)</td>
                <td  align="left">@(item.CompanyName)</td>
                <td  align="left">
                    @(item.AddressSel != null && item.AddressSel.LastIndexOf(",") > -1 ?
                    ( item.AddressSel.LastIndexOf(",",  item.AddressSel.LastIndexOf(",")-1) > -1 ? 
                        item.AddressSel.Substring(item.AddressSel.LastIndexOf(",",  item.AddressSel.LastIndexOf(",")-1)+1).Replace(",","") : item.AddressSel.Replace(",","")   )
                     :item.AddressSel.Replace(",",""))
                </td>
                <td  align="left">
                    @(item.EndAddressSel != null && item.EndAddressSel.LastIndexOf(",") > -1 ?
                    ( item.EndAddressSel.LastIndexOf(",",  item.EndAddressSel.LastIndexOf(",")-1) > -1 ? 
                        item.EndAddressSel.Substring(item.EndAddressSel.LastIndexOf(",",  item.EndAddressSel.LastIndexOf(",")-1)+1).Replace(",","") : item.EndAddressSel.Replace(",","")   )
                     :item.EndAddressSel.Replace(",",""))
                </td>
                <td  align="center">@((item.StartTime.ToString("mm")=="00"||item.StartTime.ToString("mm")=="30")?item.StartTime.ToString("HH:mm"):"")</td>
        
                <td  align="center">@((item.EndTime.ToString("mm")=="00"||item.EndTime.ToString("mm")=="30")?item.EndTime.ToString("HH:mm"):"")</td>
                <td  align="center">
                    @{var paymoney = item.money1.ToString();}
                    @(paymoney.Length > 0? paymoney.Remove(paymoney.IndexOf(".")) : "")
                </td>
                <td  align="center">
                    @{paymoney = item.money2.ToString();}
                    @(paymoney.Length > 0? paymoney.Remove(paymoney.IndexOf(".")) : "")
                </td>
                <td  align="center">
                    @{paymoney = item.money3.ToString();}
                    @(paymoney.Length > 0? paymoney.Remove(paymoney.IndexOf(".")) : "")
                </td>
                <td  align="left">@(item.Etc)</td>
				</tr>                    
        }
        
   
    </tbody>
    </table>

@*    <div class="btn"> 
       
    </div>*@
    <div id="pages">
         @Html.Pager(Model,new PagerOptions{PageIndexParameterName="page", CurrentPagerItemWrapperFormatString = "<span class=\"curpage\">{0}</span>", NumericPagerItemWrapperFormatString = "<span class=\"item\">{0}</span>", CssClass = "pages", AutoHide=false, SeparatorHtml = ""})
    </div>
</div>
</div>

<script type="text/javascript">
    function ShowWin(url, title) {

        window.location.href = url;

        /*var h = $(window.parent).height() - 60;
        var w = $(document).width() - 50;

        var url2 = "/admin/" + url;


        parent.$.layer({
            type: 2,
            title: title,
            iframe: { src: url2 },
            area: [w+'px', h+'px'],
            offset: ['20px', '']
        });*/
    }

    function openUsers(userID, userName) {
        ShowWin("UsersMain?UserID=" + userID, "会员[" + userName + "]的信息");
    }

    $(function () {

        //双击每行
        $("#userList tr").dblclick(function () {
            openUsers($(this).find('input[type="checkbox"]').val(), "");
        })

    })

    $("#userList td").mouseover(function (e) {
        if ($.trim($(this).text()) != "") {
            layer.tips($(this).text(), this, { guide: 1, time: 2 });
        }
    })

</script>


