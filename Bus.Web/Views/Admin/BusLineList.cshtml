@{
    ViewBag.Title = "BusLineList";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}
@model PagedList<Bus.Data.BusLine>
<script type="text/javascript" src="/Content/layer/layer.min.js?v=1.6.0"></script>
<div class="subnav">
    <div class="content-menu ib-a blue line-x">
        <a href='javascript:;;' class="on"><em>线路管理</em></a><span>|</span> 
        <a class="" href="BusLine"><em>添加线路</em></a>
    </div>
</div>
<style type="text/css">
	html{_overflow-y:scroll}
</style>
<div class="pad_10">

<div class="bk10"></div>
<div class="table-list">
    <table width="100%" cellspacing="0" >
        <thead>
            <tr>
            <th width="30">编号</th>
            <th >线路名称</th><th align='center' width="180">编号</th>
            <th align='center' width="180">始发地点</th>
            <th align='center' width="100">始发时间</th> 
            <th align="center" width="180">到站地点</th>
            <th align='center' width="100">返回时间</th> 
                <th align='center' width="100">创建时间</th> 
			<th width="220">管理操作</th>
            </tr>
        </thead>
    <tbody>
        @if (Model.Count == 0) { 
        <tr>
            <td colspan="9">没有任何数据</td>
        </tr>
        }
        @foreach(var item in Model){
    <tr>
					<td align='center'>@(item.ID)</td>
					<td >@(item.LineName)(<a href="javascript:;;" onclick="ViewUserList('@(item.LineName)','@(item.ID)')" style="font-weight:bold;">周围用户<font color=red>@(Bus.Core.Common.GetUserList(item.StartLong,item.StartLat).Count)</font>人</a>)</td>
		<td align='center'>@(item.Number)</td>			
        <td align='center'>@(item.StartAddress) （周围用户<font color=red>@(Bus.Core.Common.GetUserList(item.StartLong,item.StartLat).Count)</font>人）</td>
                    <td align='center'>@(item.StartTime.ToString("HH:mm"))</td>
                    <td align='center'>@(item.EndAddress)</td>
                    <td align='center'>@(item.EndTime.ToString("HH:mm"))</td>
                    <td align='center'>@(item.CreateTime.ToString("yyyy-MM-dd"))</td>
        <td align='center' ><a href="BusLine?ID=@(item.ID)">修改</a> | <a href="javascript:DelData('delbusline','@(item.ID)')">删除</a>
            | <a href="javascript:;;" onclick="ShowStation('BusLineUsersList?LineID=@(item.ID)','@(item.LineName)-预定用户')">用户</a>
            | <a href="javascript:;;" onclick="ShowStation('StationList?LineID=@(item.ID)','@(item.LineName)-站点管理')">站点</a>
             | <a href="javascript:;;" onclick="ShowStation('PaymentList?LineID=@(item.ID)','@(item.LineName)-缴费管理')">已缴费</a>
        </td>
				</tr>                    
        }
        
   
    </tbody>
    </table>

@*    <div class="btn"> 
       
    </div>*@
    <div id="pages">
         @Html.Pager(Model,new PagerOptions{PageIndexParameterName="page", CurrentPagerItemWrapperFormatString = "<span class=\"curpage\">{0}</span>", NumericPagerItemWrapperFormatString = "<span class=\"item\">{0}</span>", CssClass = "pages", AutoHide=false, SeparatorHtml = ""})
    </div>
</div>
</div>
<script type="text/javascript">
    function ViewUserList(t, v) {
        var h = $(document).height();
        h = h - 80;
        parent.$.layer({
            type: 2,
            title: '查看【'+t+'】周围用户.',
            iframe: { src: '/admin/ViewLineUser?LineID='+v },
            area: ['900px', h+'px'],
            offset: ['30px', '']
        });
    }
    
</script>
<script type="text/javascript">
    function ShowStation(url, title) {
        var url2 = "/admin/" + url;
        var h = $(document).height();
        h = h - 80;
        parent.$.layer({
            type: 2,
            title: title,
            iframe: { src: url2 },
            area: ['950px', h+'px'],
            offset: ['30px', '']
        });
    }
</script>
